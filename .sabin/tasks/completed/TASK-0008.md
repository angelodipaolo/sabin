---
status: resolved
title: Webview 'New Ticket' button not functioning despite UI appearing correctly
description: >-
  The New Ticket button in the webview is now visible but clicking it does not
  trigger the ticket creation dialog. The button appears properly styled and
  the webview is rendering, but the VS Code command is not executing.
---

## Problem

After fixing the initial webview loading issue (TICKET-0006), the webview now displays correctly with both the "Tickets Board" section and ticket cards visible. However, clicking the "New Ticket" button produces no response - no dialog appears and no errors are shown in the console.

**Current Behavior:**
- Webview renders successfully
- "New Ticket" button is visible and styled correctly
- Clicking button has no effect
- No errors in VS Code Developer Console
- TreeView displays tickets correctly

**Expected Behavior:**
- Clicking "New Ticket" should trigger VS Code input boxes for title and description
- New ticket should be created with next sequential number

## Investigation Findings

### What We Fixed in TICKET-0006

1. **Removed non-existent media/main.js reference** (webviewProvider.ts:229)
   - The webview HTML was trying to load `media/main.js` which didn't exist
   - All JavaScript is inline in the HTML template
   - Removed: `const scriptUri = webview.asWebviewUri(...)`

2. **Fixed dependency loading**
   - Created symlink: `~/.vscode/extensions/sabin.sabin-vscode-0.1.0` → development directory
   - This allows extension to use monorepo's node_modules (gray-matter, etc.)

3. **Changed button click handler** (webviewProvider.ts:280-284)
   - Changed from `prompt()` (doesn't work in webviews) to posting message
   - Message: `{ command: 'showCreateTicketDialog' }`
   - Handler calls: `vscode.commands.executeCommand('sabin.newTicket')`

### Current Implementation

**Webview Button (webviewProvider.ts:280-284):**
```javascript
function createNewTicket() {
  vscode.postMessage({
    command: 'showCreateTicketDialog'
  });
}
```

**Message Handler (webviewProvider.ts:29-50):**
```typescript
webviewView.webview.onDidReceiveMessage(async (data) => {
  switch (data.command) {
    case 'showCreateTicketDialog':
      await vscode.commands.executeCommand('sabin.newTicket');
      break;
    // ... other cases
  }
});
```

**Command Registration (extension.ts:34-39):**
```typescript
context.subscriptions.push(
  vscode.commands.registerCommand('sabin.newTicket', async () => {
    await createNewTicket(workspaceRoot);
    ticketProvider.refresh();
  })
);
```

### Possible Root Causes

1. **Message not reaching handler**
   - `vscode` API object may not be properly acquired in webview
   - `acquireVsCodeApi()` may be failing silently
   - No error logging in place to confirm

2. **Command not registered/accessible**
   - `sabin.newTicket` command may not be available when webview loads
   - Extension activation timing issue
   - Command may require different context

3. **Webview context isolation**
   - Content Security Policy blocking message posting
   - Current CSP: `default-src 'none'; style-src ${webview.cspSource}; script-src 'nonce-${nonce}'`
   - May need to allow `vscode-webview://` for messaging

4. **Event handler not attached**
   - HTML button uses `onclick="createNewTicket()"`
   - Function may not be in global scope
   - Script execution order issue

5. **Silent error in command execution**
   - `createNewTicket()` function in extension.ts may be throwing
   - Need to add try/catch and logging

## Requirements

1. **Add debug logging**
   - Log when button is clicked in webview
   - Log when message is received in extension
   - Log when command executes
   - Add error handling with console output

2. **Verify vscode API**
   - Confirm `acquireVsCodeApi()` succeeds
   - Test message posting separately
   - Check Developer Console for any errors

3. **Test command directly**
   - Try executing `sabin.newTicket` from Command Palette
   - Verify command works outside of webview context
   - Check activation events

4. **Review CSP policy**
   - Ensure webview can post messages
   - Check if additional permissions needed
   - Test with relaxed CSP temporarily

5. **Check timing issues**
   - Verify extension is fully activated before webview loads
   - Add activation status logging
   - Test with manual refresh

## Acceptance Criteria

- [ ] Clicking "New Ticket" button opens VS Code input box for title
- [ ] After entering title, description input box appears
- [ ] Ticket is created with correct sequential number
- [ ] New ticket appears in both webview and TreeView
- [ ] Console shows clear debug output for troubleshooting
- [ ] Error messages are displayed if creation fails

## Technical Notes

**Files Modified:**
- `packages/vscode-extension/src/providers/webviewProvider.ts`
- `packages/vscode-extension/src/extension.ts`

**Test Steps:**
1. Open VS Code Developer Console (Help → Toggle Developer Tools)
2. Click Sabin icon in Activity Bar
3. Click "New Ticket" button
4. Observe console output
5. Check for any errors or warnings
6. Verify message flow: webview → extension → command

**Related Code:**
- webviewProvider.ts:280-284 (button click handler)
- webviewProvider.ts:29-50 (message receiver)
- extension.ts:34-39 (command registration)
- extension.ts:63-136 (createNewTicket function)

## Next Steps

1. Add comprehensive logging at each step
2. Test command execution from Command Palette
3. Verify webview-to-extension message flow
4. Check activation timing
5. Review CSP policy if needed
