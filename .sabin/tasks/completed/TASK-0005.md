---
status: resolved
title: Bundle VS Code extension properly to avoid node_modules deployment issues
description: Fix the extension packaging to include dependencies without manual copying
---

## Problem

The VS Code extension currently requires manual copying of `node_modules` to work when installed. This is because:
- Extension depends on `gray-matter` npm package
- Manual deployment (copying `dist/` and `package.json`) doesn't include dependencies
- Extension fails to activate with: `Cannot find module 'gray-matter'`
- This prevents VSIX packaging from working properly

## Current Workaround

```bash
# Manual deployment requires copying entire node_modules
cp -R node_modules ~/.vscode/extensions/sabin.sabin-vscode-0.1.0/
cp -R dist/* ~/.vscode/extensions/sabin.sabin-vscode-0.1.0/dist/
```

This is not sustainable for:
- Distribution to other users
- Publishing to VS Code marketplace
- Development workflow (must copy after every change)

## Requirements

1. **Bundle the extension using esbuild or webpack**
   - Bundle all TypeScript source files into a single JavaScript file
   - Include all npm dependencies (gray-matter, etc.) in the bundle
   - No external `node_modules` required at runtime
   - Output should be significantly smaller than current approach

2. **Update build scripts**
   - Add bundling to `npm run compile` or create separate `npm run bundle` script
   - Ensure bundled output works for development and production

3. **Enable VSIX packaging**
   - `npx @vscode/vsce package` should complete successfully
   - VSIX should be under 10MB (currently fails due to monorepo size)
   - Package should contain only necessary files (dist/, package.json, README, media/)

4. **Update .vscodeignore**
   - Exclude source files, node_modules, tests
   - Include only bundled dist/ and required assets

5. **Test deployment**
   - Install VSIX package: `code --install-extension sabin-vscode-0.1.0.vsix`
   - Verify extension activates without errors
   - Verify both bugs from TICKET-0002 remain fixed:
     - Create ticket button works with correct numbering
     - TreeView shows tickets properly (no "No tickets found")

6. **Update development workflow documentation**
   - Document how to build and package extension
   - Document how to test locally (F5 vs VSIX install)

## Acceptance Criteria

- [ ] Extension bundled with esbuild or webpack
- [ ] Single bundle file in dist/ (e.g., `extension.js`)
- [ ] VSIX package successfully created with `@vscode/vsce package`
- [ ] VSIX size under 10MB
- [ ] Extension installs and activates without errors
- [ ] Create ticket button works (TICKET-0006 created with correct numbering)
- [ ] TreeView displays tickets correctly
- [ ] No manual copying of node_modules required

## Technical Notes

**Bundler Options:**
- **esbuild** (recommended): Faster, simpler config, VS Code docs recommend it
- **webpack**: More features, but slower and more complex

**Example esbuild config:**
```js
// esbuild.config.js
const esbuild = require('esbuild');

esbuild.build({
  entryPoints: ['src/extension.ts'],
  bundle: true,
  outfile: 'dist/extension.js',
  external: ['vscode'],
  format: 'cjs',
  platform: 'node',
  sourcemap: true,
}).catch(() => process.exit(1));
```

**References:**
- VS Code bundling guide: https://code.visualstudio.com/api/working-with-extensions/bundling-extension
- @vscode/vsce docs: https://github.com/microsoft/vscode-vsce

